金融行情监控系统开发设计说明书 (V1.0)
1. 项目背景、诉求与价值
1.1. 背景与诉求
本项目旨在为个人投资者开发一套自动化、PC端运行的金融行情监控系统。当前，投资者获取市场信息依赖于手动刷新多个软件、浏览大量资讯，过程耗时且效率低下。更重要的是，人脑在盘中及盘后容易受到情绪和零散信息干扰，难以形成对市场全局的、客观、一致的判断，从而做出追涨杀跌等非理性决策。

本项目核心诉求是：自动化地聚合关键行情数据，通过AI进行提炼总结，最终生成一份高度浓缩、直观可视的每日市场复盘报告。

1.2. 核心价值
决策客观化：用量化数据和AI结论替代主观感受，克服情绪化交易。

效率最大化：每日自动生成复盘报告，将投资者从繁杂的信息收集中解放出来。

洞察主流行情：通过三圈层监控体系，快速识别市场主线、风格切换与潜在风险。

2. 最终交付效果
项目第一阶段的最终交付物是一份每日生成的、名为 report_YYYY-MM-DD.html 的静态HTML文件。该文件是一个信息密度极高、视觉清晰的仪表盘，其核心布局与内容如下：

顶部标题区：显示“金融行情监控仪表盘”及报告生成日期。

摘要与核心看板模块：

AI核心结论：由DeepSeek API生成的、对当日行情的摘要性文字总结。

A股市场温度：包含上证、创业板、科创50指数的收盘点位、当日涨跌、成交额，以及A股整体的涨跌比。

A股核心圈深度分析模块：

市场风格与规模：表格展示大/小盘、价值/成长等风格ETF的当日表现。

行业与主题板块：核心表格，完整包含清单中所有关键行业ETF，并严格按照当日涨跌幅从高到低排序。表格需包含ETF名称、涨跌幅，以及其核心成分股/龙头的当日表现。领涨和领跌的板块将用不同背景色高亮显示。

风险偏好：表格展示国内（黄金ETF、国债ETF）及全球（COMEX黄金、10年期美债收益率）的风险/避险资产表现及解读。

全球环境与关联市场模块：

表格化展示关联圈（港股）、环境圈（美股、加密货币、其他）中所有关键指标的当日状态和解读。

该静态页面设计精炼，所有数据均为当日快照，无历史图表或交互功能，旨在实现第一阶段“清晰、全面地看懂当天市场”的核心目标。

3. 总体实现方案
本项目采用**【方案二：模块化稳健方案】**进行开发，以确保代码的高可维护性、可读性和未来扩展性。

核心语言：Python 3.x

核心库：

数据获取：akshare

数据处理：pandas

HTTP请求：requests (用于调用AI API)

报告生成：Jinja2 (用于HTML模板渲染)

邮件发送：smtplib, email

开发原则：遵循“高内聚，低耦合”的原则，将不同职责的功能封装在独立的模块中，由主程序进行统一调度。

4. 架构设计与流程
4.1. 项目目录结构规划
/financial_dashboard
|
|-- /data_handler/
|   |-- __init__.py
|   |-- fetcher.py         # 核心数据获取模块：封装所有akshare接口调用
|
|-- /analysis/
|   |-- __init__.py
|   |-- calculator.py      # 数据计算模块：计算涨跌幅、涨跌比等
|   |-- ai_summary.py      # AI分析模块：构造prompt并调用DeepSeek API
|
|-- /reporter/
|   |-- __init__.py
|   |-- generator.py       # 报告生成模块：使用Jinja2渲染HTML模板
|   |-- mailer.py          # 邮件发送模块
|
|-- /config/
|   |-- __init__.py
|   |-- market_watch_list.py # 监控清单：以Python字典形式定义所有监控对象
|   |-- settings.py        # 配置文件：如API密钥、邮箱配置、文件路径等
|
|-- /templates/
|   |-- report_template.html # Jinja2 HTML模板文件
|
|-- /output/
|   |-- /reports/          # 存放生成的HTML报告
|   |-- /logs/             # 存放日志文件
|   |-- /data/             # 存放每日原始数据备份
|
|-- main.py                # 主程序入口：调度所有模块，执行核心流程
|-- requirements.txt       # 项目依赖库列表
|-- README.md              # 项目说明文件


4.2. 关键运行时序图
sequenceDiagram
    participant Scheduler as Windows任务计划程序
    participant Main as main.py
    participant Fetcher as data_handler.fetcher
    participant Calculator as analysis.calculator
    participant AI as analysis.ai_summary
    participant Generator as reporter.generator
    participant Mailer as reporter.mailer

    Scheduler->>Main: 在预设时间(如15:30)触发运行
    Main->>Fetcher: 调用fetch_all_data()
    Fetcher-->>Main: 返回包含所有原始数据的字典
    Main->>Calculator: 传入原始数据字典
    Calculator-->>Main: 返回计算好涨跌幅等指标的“处理后数据字典”
    Main->>AI: 传入“处理后数据字典”
    AI-->>Main: 返回DeepSeek生成的“AI结论字符串”
    Main->>Generator: 传入“处理后数据字典”和“AI结论字符串”
    Generator-->>Main: 生成 report_YYYY-MM-DD.html 文件并返回文件路径
    Main->>Mailer: 传入报告文件路径
    Mailer-->>Main: 发送邮件成功


5. 运维、日志与数据本地化
5.1. 部署与运维
部署环境：Windows PC

依赖安装：通过 pip install -r requirements.txt 安装所有依赖。

配置：首次运行时，需在 /config/settings.py 中填入正确的DeepSeek API密钥、邮箱服务器信息及收发件人地址。

自动化调度：使用Windows自带的“任务计划程序”创建新任务，设置触发器为“每个交易日”的“15:30”，操作为“启动程序”，程序或脚本指向本项目的 main.py 的Python解释器路径。

5.2. 日志记录
目的：记录程序运行状态，便于排查数据获取失败、API调用异常等问题。

方案：使用Python内置的 logging 模块。

在 main.py 中进行初始化配置。

同时输出到控制台和文件 (/output/logs/app_YYYY-MM-DD.log)。

日志格式应包含：时间戳、日志级别、模块名、日志信息。

5.3. 数据本地化
目的：备份每日原始数据，用于问题追溯和未来的数据分析。

方案：

data_handler.fetcher 模块在获取完所有原始数据后，应将其以CSV或JSON格式保存到 /output/data/raw_data_YYYY-MM-DD.csv。

reporter.generator 模块生成的HTML报告，保存到 /output/reports/report_YYYY-MM-DD.html。

6. 开发规范与要求
代码风格：严格遵循 PEP 8 规范。

命名：函数、变量、模块名需清晰易懂，使用下划线命名法（如 fetchMarketData）。

注释与文档字符串：所有核心函数和模块都必须有标准的Docstring，解释其功能、参数和返回值。复杂逻辑处需添加行内注释。

配置与代码分离：严禁将API密钥、文件路径等硬编码在业务逻辑代码中，所有配置项必须统一放在 /config 目录下。

错误处理：所有外部依赖调用（文件读写、API请求、数据获取）都必须包含在 try...except 块中，并记录详细的错误日志。

易读性优先：避免使用过于复杂或晦涩的Pythonic写法（如多层嵌套的列表推导式）。优先保证代码逻辑的清晰、直白，方便他人阅读和维护。

类型提示：建议为所有函数的参数和返回值添加类型提示（Type Hinting），以增强代码的健壮性和可读性。

7. 附录：核心模块设计要点
7.1. DeepSeek API Prompt 设计
analysis.ai_summary 模块的核心是构造一个高质量的Prompt。以下是推荐的Prompt模板，开发时需将 [...] 部分替换为真实数据。

你是一位专业的、风格中立客观的中国A股市场金融分析师。请根据以下今日收盘后的结构化数据，为我生成一份不超过200字的、高度概括的当日市场核心结论。

你的结论必须包含以下几个要点：
1.  **市场整体评价**：一句话概括今天市场是普涨、普跌还是分化，成交量是放大还是缩小。
2.  **核心领涨主线**：明确指出今天领涨的1-3个最关键板块，并提及其中表现最突出的龙头股。
3.  **主要领跌板块**：指出今天表现最弱的1-2个板块。
4.  **市场风格判断**：说明今天的市场风格是偏向大盘股还是小盘股。
5.  **关键信号解读**：结合全球市场和风险偏好数据，解读1-2个最重要的积极或消极信号（例如人民币升值、美股科技股大涨等）。

请直接输出结论，不要有任何客套话。

---
**【今日行情数据】**

**A股市场温度:**
- 上证指数: [涨跌幅], 创业板指: [涨跌幅], 科创50指: [涨跌幅]
- A股总成交额: [成交额]，较昨日[放大/缩小]
- 涨跌比: [上涨家数] : [下跌家数]

**市场风格:**
- 大盘股 (沪深300ETF): [涨跌幅]
- 中小盘股 (中证1000ETF): [涨跌幅]

**行业板块表现 (Top 5):**
1. [板块名]: [涨跌幅], 龙头股 [龙头股名]: [涨跌幅]
2. [板块名]: [涨跌幅], 龙头股 [龙头股名]: [涨跌幅]
...

**行业板块表现 (Bottom 3):**
1. [板块名]: [涨跌幅]
2. [板块名]: [涨跌幅]
...

**全球及风险信号:**
- 美股纳斯达克100指数: [涨跌幅]
- 港股恒生科技指数: [涨跌幅]
- 美元/离岸人民币: [状态与变动]
- 10年期美债收益率: [状态与变动]
- COMEX黄金: [涨跌幅]

